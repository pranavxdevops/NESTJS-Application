'use client';

import { useEffect, useRef, useState } from 'react';

interface MoreActionsMenuProps {
  onMessage?: () => void;
  onReport?: () => void;
}

export default function MoreActionsMenu({ onMessage, onReport }: MoreActionsMenuProps) {
  const [open, setOpen] = useState(false);
  const menuRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const handler = (e: MouseEvent) => {
      if (menuRef.current && !menuRef.current.contains(e.target as Node)) {
        setOpen(false);
      }
    };
    document.addEventListener('mousedown', handler);
    return () => document.removeEventListener('mousedown', handler);
  }, []);

  return (
    <div ref={menuRef} className="absolute bottom-4 right-3 z-50">
      {/* 3 dots */}
      <button
        onClick={(e) => {
          e.stopPropagation();
          setOpen((prev) => !prev);
        }}
        className="bg-wfzo-gold-25 p-1.5 rounded-[8px] border border-[#E7DACB] hover:bg-wfzo-gold-50 transition"
      >
        <svg
          width="20"
          height="20"
          viewBox="0 0 20 20"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M10.0007 16.6673C9.54232 16.6673 9.14996 16.5041 8.82357 16.1777C8.49718 15.8513 8.33398 15.459 8.33398 15.0007C8.33398 14.5423 8.49718 14.15 8.82357 13.8236C9.14996 13.4972 9.54232 13.334 10.0007 13.334C10.459 13.334 10.8513 13.4972 11.1777 13.8236C11.5041 14.15 11.6673 14.5423 11.6673 15.0007C11.6673 15.459 11.5041 15.8513 11.1777 16.1777C10.8513 16.5041 10.459 16.6673 10.0007 16.6673ZM10.0007 11.6673C9.54232 11.6673 9.14996 11.5041 8.82357 11.1777C8.49718 10.8513 8.33398 10.459 8.33398 10.0007C8.33398 9.54232 8.49718 9.14996 8.82357 8.82357C9.14996 8.49718 9.54232 8.33398 10.0007 8.33398C10.459 8.33398 10.8513 8.49718 11.1777 8.82357C11.5041 9.14996 11.6673 9.54232 11.6673 10.0007C11.6673 10.459 11.5041 10.8513 11.1777 11.1777C10.8513 11.5041 10.459 11.6673 10.0007 11.6673ZM10.0007 6.66732C9.54232 6.66732 9.14996 6.50412 8.82357 6.17773C8.49718 5.85135 8.33398 5.45898 8.33398 5.00065C8.33398 4.54232 8.49718 4.14996 8.82357 3.82357C9.14996 3.49718 9.54232 3.33398 10.0007 3.33398C10.459 3.33398 10.8513 3.49718 11.1777 3.82357C11.5041 4.14996 11.6673 4.54232 11.6673 5.00065C11.6673 5.45898 11.5041 5.85135 11.1777 6.17773C10.8513 6.50412 10.459 6.66732 10.0007 6.66732Z"
            fill="#8B6941"
          />
        </svg>
      </button>

      {/* Popup */}
      {open && (
        <div
          className="
            absolute right-0 mt-2 w-[226px] bg-white
            rounded-[8px]
            py-2
            z-50
          "
          style={{
            boxShadow:
              '0px 10px 32px -4px rgba(139,105,65,0.10), 0px 6px 14px -6px rgba(139,105,65,0.12)',
          }}
        >
          <button
            onClick={() => {
              setOpen(false);
              onMessage?.();
            }}
            className="
              w-full flex items-center gap-3
              px-4 py-2 text-sm text-neutral-800
              hover:bg-neutral-100
            "
          >
            <svg
              width="15"
              height="13"
              viewBox="0 0 15 13"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M14 7.02671L1.16667 12.4434C0.888889 12.5545 0.625 12.5302 0.375 12.3705C0.125 12.2107 0 11.9781 0 11.6725V0.839209C0 0.533654 0.125 0.301015 0.375 0.141293C0.625 -0.0184295 0.888889 -0.042735 1.16667 0.0683761L14 5.48504C14.3472 5.63782 14.5208 5.89476 14.5208 6.25588C14.5208 6.61699 14.3472 6.87393 14 7.02671ZM1.66667 10.4225L11.5417 6.25588L1.66667 2.08921V5.00588L6.66667 6.25588L1.66667 7.50588V10.4225Z"
                fill="#8B6941"
              />
            </svg>
            Message
          </button>

          <button
            onClick={() => {
              setOpen(false);
              onReport?.();
            }}
            className="
              w-full flex items-center gap-3
              px-4 py-2 text-sm text-neutral-800
              hover:bg-neutral-100
            "
          >
            <svg
              width="17"
              height="17"
              viewBox="0 0 17 17"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M8.33333 16.6667C7.18056 16.6667 6.09722 16.4479 5.08333 16.0104C4.06944 15.5729 3.1875 14.9792 2.4375 14.2292C1.6875 13.4792 1.09375 12.5972 0.65625 11.5833C0.21875 10.5694 0 9.48611 0 8.33333C0 7.18056 0.21875 6.09722 0.65625 5.08333C1.09375 4.06944 1.6875 3.1875 2.4375 2.4375C3.1875 1.6875 4.06944 1.09375 5.08333 0.65625C6.09722 0.21875 7.18056 0 8.33333 0C9.48611 0 10.5694 0.21875 11.5833 0.65625C12.5972 1.09375 13.4792 1.6875 14.2292 2.4375C14.9792 3.1875 15.5729 4.06944 16.0104 5.08333C16.4479 6.09722 16.6667 7.18056 16.6667 8.33333C16.6667 9.48611 16.4479 10.5694 16.0104 11.5833C15.5729 12.5972 14.9792 13.4792 14.2292 14.2292C13.4792 14.9792 12.5972 15.5729 11.5833 16.0104C10.5694 16.4479 9.48611 16.6667 8.33333 16.6667ZM8.33333 15C9.08333 15 9.80555 14.8785 10.5 14.6354C11.1944 14.3924 11.8333 14.0417 12.4167 13.5833L3.08333 4.25C2.625 4.83333 2.27431 5.47222 2.03125 6.16667C1.78819 6.86111 1.66667 7.58333 1.66667 8.33333C1.66667 10.1944 2.3125 11.7708 3.60417 13.0625C4.89583 14.3542 6.47222 15 8.33333 15ZM13.5833 12.4167C14.0417 11.8333 14.3924 11.1944 14.6354 10.5C14.8785 9.80555 15 9.08333 15 8.33333C15 6.47222 14.3542 4.89583 13.0625 3.60417C11.7708 2.3125 10.1944 1.66667 8.33333 1.66667C7.58333 1.66667 6.86111 1.78819 6.16667 2.03125C5.47222 2.27431 4.83333 2.625 4.25 3.08333L13.5833 12.4167Z"
                fill="#808080"
              />
            </svg>
            Report / Block
          </button>
        </div>
      )}
    </div>
  );
}
